let restaurants,neighborhoods,cuisines;var newMap,markers=[];document.addEventListener('DOMContentLoaded',()=>{fetchNeighborhoods(),fetchCuisines(),initMap()}),initMap=()=>{var a=self.newMap=L.map('map',{center:[40.722216,-73.987501],zoom:12,scrollWheelZoom:!1});L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}',{mapboxToken:'pk.eyJ1IjoibWE3bW91ZDIwMTgiLCJhIjoiY2prZmZvNjczMDZseDNwbzY3ajU3dG94OCJ9.L9ZgU0pFAHMjWkRwp9Meog',maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',id:'mapbox.streets'}).addTo(a),updateRestaurants()},fetchNeighborhoods=()=>{DBHelper.fetchNeighborhoods().then(a=>{self.neighborhoods=a,fillNeighborhoodsHTML()}).catch(a=>console.error(a))},fillNeighborhoodsHTML=(a=self.neighborhoods)=>{const b=document.getElementById('neighborhoods-select');a.forEach(c=>{const d=document.createElement('option');d.innerHTML=c,d.value=c,b.append(d)})},fetchCuisines=()=>{DBHelper.fetchCuisines().then(a=>{self.cuisines=a,fillCuisinesHTML()}).catch(a=>console.log(a))},fillCuisinesHTML=(a=self.cuisines)=>{const b=document.getElementById('cuisines-select');a.forEach(c=>{const d=document.createElement('option');d.innerHTML=c,d.value=c,b.append(d)})},updateRestaurants=()=>{const a=document.getElementById('cuisines-select'),b=document.getElementById('neighborhoods-select'),c=a.selectedIndex,d=b.selectedIndex,e=a[c].value,f=b[d].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(e,f).then(g=>{resetRestaurants(g),fillRestaurantsHTML()}).catch(g=>console.error(g))},resetRestaurants=a=>{self.restaurants=[];const b=document.getElementById('restaurants-list');b.innerHTML='',self.markers&&self.markers.forEach(c=>c.remove()),self.markers=[],self.restaurants=a},fillRestaurantsHTML=(a=self.restaurants)=>{const b=document.getElementById('restaurants-list');a.forEach(c=>{b.append(createRestaurantHTML(c))}),addMarkersToMap()},createRestaurantHTML=a=>{const b=document.createElement('li'),c=document.createElement('img');c.className='restaurant-img',c.alt=a.name+' logo ',c.src=DBHelper.imageUrlForRestaurant(a),b.append(c);const d=document.createElement('h1');d.innerHTML=a.name,b.append(d);const e=document.createElement('div');e.innerHTML='&#9733;',e.className='favBtn',a.is_favorite&&e.classList.add('on'),e.addEventListener('click',function(){const i=!a.is_favorite;DBHelper.updateFav(a.id,i),a.is_favorite=i,i?this.setAttribute('aria-label','Remove From Favorite'):this.setAttribute('aria-label','Mark As Favorite'),this.classList.toggle('on')}),b.append(e);const f=document.createElement('p');f.innerHTML=a.neighborhood,b.append(f);const g=document.createElement('p');g.innerHTML=a.address,b.append(g);const h=document.createElement('button');return h.innerHTML='View Details',h.onclick=function(){const i=DBHelper.urlForRestaurant(a);window.location=i},b.append(h),b},addMarkersToMap=(a=self.restaurants)=>{a.forEach(b=>{const d=DBHelper.mapMarkerForRestaurant(b,self.newMap);d.on('click',function(){window.location.href=d.options.url}),self.markers.push(d)})};
